{{- if .Values.idaProxy.enabled }}
apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ if .Values.idaMcp.k8s.proxyConfigMapPorts }}{{ .Values.idaMcp.k8s.proxyConfigMapPorts }}{{ else }}{{ include "mcp-client.fullname" . }}-ida-proxy-listen-ports{{ end }}
  labels:
    app: ida-mcp
    component: proxy
    {{- include "mcp-client.labels" . | nindent 4 }}
data:
  listen_ports.conf: |
    # IDA Proxy listen ports configuration
    # Managed by MCP Client controller via GitOps (Bitbucket -> ArgoCD)
    # DO NOT EDIT MANUALLY
    #
    {{- if .Values.idaProxy.portMappings }}
    {{- range .Values.idaProxy.portMappings }}
    listen {{ .proxyPort }};
    {{- end }}
    {{- else }}
    # No port mappings configured
    # Ports will be added here as users deploy their MCP servers
    # Example:
    # listen 9001;
    # listen 9002;
    {{- end }}
{{- end }}
