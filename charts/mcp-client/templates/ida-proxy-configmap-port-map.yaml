{{- if .Values.idaProxy.enabled }}
apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ include "mcp-client.fullname" . }}-ida-proxy-port-map
  labels:
    app: ida-mcp
    component: proxy
    {{- include "mcp-client.labels" . | nindent 4 }}
data:
  port_map.conf: |
    # Auto-managed by MCP Client controller
    # This file maps proxy ports to upstream IDA workstations
    # DO NOT EDIT MANUALLY
    #
    # Format: PROXY_PORT   UPSTREAM_HOST:UPSTREAM_PORT;
    #
    # Initial mappings from Helm values:
    {{- if .Values.idaProxy.initialPortMappings }}
    {{- range .Values.idaProxy.initialPortMappings }}
    {{ .proxyPort }}          {{ .upstreamHost }}:{{ .upstreamPort }};
    {{- end }}
    {{- else }}
    # No initial port mappings configured
    # Mappings will be added here as users deploy their MCP servers
    # Example:
    # 9001          userA-workstation.corp.example.com:9100;
    # 9002          userB-workstation.corp.example.com:9100;
    {{- end }}
{{- end }}
